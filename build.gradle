plugins {
    id "maven"
    id "org.jetbrains.kotlin.jvm" version "1.1.51"
    id "com.github.johnrengelman.shadow" version "2.0.1"
    id 'com.github.ben-manes.versions' version '0.15.0'
    id "maven-publish"
    id "com.jfrog.bintray" version "1.7.3"
}

group = "com.serebit"
version = "0.3.2"

description = """"""

repositories {
    jcenter()
    mavenCentral()
    maven { url "https://jitpack.io" }
}

dependencies {
    compile group: "org.jetbrains.kotlin", name: "kotlin-stdlib-jre8"
    compile group: "org.jetbrains.kotlinx", name: "kotlinx-coroutines-core", version: "0.20-alpha-6"
    compile group: "com.serebit", name: "autotitan-api", version: "0.2.0"
    compile group: "commons-validator", name: "commons-validator", version: "1.6"
    compile group: "net.dv8tion", name: "JDA", version: "3.3.1_292"
    compile group: "com.sedmelluq", name: "lavaplayer", version: "1.2.44"
    compile group: "com.google.code.gson", name: "gson", version: "2.8.2"
    compile group: "com.google.guava", name: "guava", version: "23.2-jre"
    compile group: "org.slf4j", name: "slf4j-simple", version: "1.8.0-beta0"
    compile group: "com.github.oshi", name: "oshi-core", version: "3.4.4"
    testCompile group: "org.jetbrains.kotlin", name: "kotlin-test"
}

kotlin {
    experimental.coroutines "enable"
}

compileKotlin {
    kotlinOptions {
        jvmTarget = "1.8"
        javaParameters = true
    }
}

compileTestKotlin {
    kotlinOptions.jvmTarget = "1.8"
}

shadowJar {
    manifest.attributes "Main-Class": "com.serebit.autotitan.MainKt"
    archiveName = "${baseName}.${extension}"
}

build {
    dependsOn shadowJar
    jar.enabled = false
}

publishing.publications {
    BintrayRelease(MavenPublication) {
        from components.java
        groupId group
        artifactId archivesBaseName
        version version
    }
}

bintray {
    user = System.getenv("BINTRAY_USER")
    key = System.getenv("BINTRAY_KEY")
    publications = ["BintrayRelease"]
    pkg {
        repo = "Maven"
        name = "autotitan"
        licenses = ["Apache-2.0"]
        vcsUrl = "https://github.com/serebit/autotitan.git"
        version {
            name = project.version
            released = new Date()
        }
    }
}

bintrayUpload {
    dependsOn build
    onlyIf { !System.getenv("BINTRAY_USER").isEmpty() }
    onlyIf { !System.getenv("BINTRAY_KEY").isEmpty() }
}
